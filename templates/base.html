<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>Sgc</title>
    <link rel="shortcut icon" href="{% static 'assets/img/favicon.png' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,500;0,600;0,700;1,400&amp;display=swap">
    <link rel="stylesheet" href="{% static 'assets/plugins/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/plugins/fontawesome/css/fontawesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/plugins/fontawesome/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <!--  datatable -->
    <link rel="stylesheet" href="{% static 'assets/plugins/datatables/datatables.min.css' %}">
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Font Link for Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    
</head>
<body>
<div class="main-wrapper">
    {% include "base_desine/header.html" %}
    {% include "base_desine/sidebar.html" %}
    <div class="page-wrapper">
        <div class="content container-fluid">
            {% block content %}
            {% endblock %}
            {% include "base_desine/footer.html" %}
        </div>
    </div>
</div>
  
<script>
    // Function to automatically submit the exam
    function submitExamAutomatically(examType) {
        const examId = localStorage.getItem('exam_id');
        if (examId) {
            const formData = new FormData();
            formData.append('exam_id', examId);
    
            // Loop through saved answers
            for (let i = 1; i <= localStorage.getItem(`exam_${examId}_total_questions`); i++) {
                const answer = localStorage.getItem(`exam_${examId}_question_${i}`);
                if (answer) {
                    formData.append(i, answer);
                    console.log(`Appending question ${i} with answer: ${answer}`);
                }
            }

            // Determine the correct URL based on exam type
            let url;
            if (examType === 'live') {
                url = "{% url 'student-live-exam-calculate-marks' %}";
            } else  {
                url = "{% url 'student-practice-exam-calculate-marks' %}";
            }
            
            console.log("Attempting AJAX request to:", url);

            $.ajax({
                url: url,
                method: "POST",
                data: formData,
                processData: false,
                contentType: false,
                headers: {
                    'X-CSRFToken': "{{ csrf_token }}"
                },
                success: function(response) {
                    console.log("AJAX success:", response);
                    alert('Your exam has been submitted because the time is up.');
                    localStorage.removeItem('exam_remaining_time');
                    localStorage.removeItem('exam_id');
                    if (examType === 'live') {
                        window.location.href = "{% url 'student-live-exam-mark' %}";
                    } else {
                        window.location.href = "{% url 'student-practice-exam-mark' %}";
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX error:", status, error);
                    alert('There was an error submitting your exam. Please try again.');
                }
            });
        }
    }
    

    // Function to format time as HH:MM:SS
    function formatTime(seconds) {
        const hrs = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    // Function to update the timer
    function updateTimer(examType) {
        let remainingTime = parseInt(localStorage.getItem('exam_remaining_time'));
        if (remainingTime !== null && remainingTime > 0) {
            remainingTime--;
            localStorage.setItem('exam_remaining_time', remainingTime);
    
            // Update the timer display in HH:MM:SS format
            if (document.getElementById('timer')) {
                document.getElementById('timer').innerText = ` ${formatTime(remainingTime)}`;
            }
        } else if (remainingTime === 0) {
            submitExamAutomatically(examType);
        }
    }

    // Periodically check the timer every second
    setInterval(function() {
        const examId = localStorage.getItem('exam_id');
        if (examId) {
            // Pass the exam type to the updateTimer function
            const examType = localStorage.getItem('exam_type');
            updateTimer(examType);
        }
    }, 1000);
</script>




<script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'assets/js/popper.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/plugins/slimscroll/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'assets/plugins/apexchart/apexcharts.min.js' %}"></script>
<script src="{% static 'assets/plugins/apexchart/chart-data.js' %}"></script>
<script src="{% static 'assets/js/script.js' %}"></script>
<script src="{% static 'assets/plugins/datatables/datatables.min.js' %}"></script>
<script src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#table_id').dataTable();
    });
</script>



</body>
</html>
